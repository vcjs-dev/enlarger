"use strict";var k=Object.defineProperty;var f=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var m=(t,e,i)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,p=(t,e)=>{for(var i in e||(e={}))b.call(e,i)&&m(t,i,e[i]);if(f)for(var i of f(e))v.call(e,i)&&m(t,i,e[i]);return t};var r=(t,e,i)=>(m(t,typeof e!="symbol"?e+"":e,i),i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("fourdom");var h=(t=>(t.getContainerError="container element is missing.",t.getMaskElError="mask element is missing.",t.getEnlargerMainElError="enlarger main element is missing.",t.getMagnifyContainerError="magnify container element is missing.",t.getMagnifyImgElError="magnify img element is missing.",t))(h||{});class u{constructor(e){r(this,"userOptions",{container:"",src:""});r(this,"options",{container:"",src:"",alt:"",width:0,height:0,resizeable:!1,magnifyImgScaleUpTimes:2,maskColor:"rgba(255, 255, 255, 0.2)",maskTimesSmallerThanImage:2,maskCursor:"crosshair",maskBorderColor:"#bbbbbb",maskBorderWidth:"1px",maskBorderStyle:"solid"});r(this,"maskWidth",0);r(this,"maskHeight",0);r(this,"maskVisible",!1);r(this,"imgNaturalWidth",0);r(this,"imgNaturalHeight",0);r(this,"magnifyImgWidthScaleUpTimes",1);r(this,"magnifyImgHeightScaleUpTimes",1);r(this,"containerEl",null);r(this,"resizeObserver",null);this.userOptions=p({},e),this.maskVisibleListener=this.maskVisibleListener.bind(this),this.magnifyListener=this.magnifyListener.bind(this),this.getImageNaturalSize(e.src,()=>{this.initResizeObserver(),this.render()})}setOptions(e){return this.userOptions=Object.assign(this.userOptions,e),this.render(),this}setWidth(e){return this.userOptions=Object.assign(this.userOptions,{width:e}),this.render(),this}setHeight(e){return this.userOptions=Object.assign(this.userOptions,{height:e}),this.render(),this}initResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{for(const i of e){const s=i.target;this.setWidth(s.offsetWidth)}}),this.resizeObserver.observe(this.getContainer())}initOptions(){const e=this.userOptions;this.options=Object.assign(this.options,e),this.magnifyImgWidthScaleUpTimes=e!=null&&e.width?this.imgNaturalWidth/e.width:this.options.magnifyImgScaleUpTimes,this.options.width=(e==null?void 0:e.width)||this.imgNaturalWidth/this.magnifyImgWidthScaleUpTimes,this.magnifyImgHeightScaleUpTimes=e!=null&&e.height?this.imgNaturalHeight/e.height:this.magnifyImgWidthScaleUpTimes,this.options.height=(e==null?void 0:e.height)||this.imgNaturalHeight/this.magnifyImgHeightScaleUpTimes,this.maskWidth=this.options.width/this.options.maskTimesSmallerThanImage,this.maskHeight=this.options.width/this.options.maskTimesSmallerThanImage}initCSSVars(){const e=this.getContainer(),i=this.options.resizeable?"auto":`${this.options.width}px`,s=this.options.resizeable?"auto":`${this.options.height}px`;l.css(e,{"--enlarger-width":i,"--enlarger-height":s,"--enlarger-mask-color":this.options.maskColor,"--enlarger-mask-width":`${this.maskWidth}px`,"--enlarger-mask-height":`${this.maskHeight}px`,"--enlarger-mask-border-width":this.options.maskBorderWidth,"--enlarger-mask-border-color":this.options.maskBorderColor,"--enlarger-mask-border-style":this.options.maskBorderStyle,"--enlarger-mask-cursor":this.options.maskCursor,"--enlarger-magnify-position-left":`${this.options.width+10}px`,"--enlarger-magnify-width":`${this.maskWidth*this.magnifyImgWidthScaleUpTimes}px`,"--enlarger-magnify-height":`${this.maskHeight*this.magnifyImgHeightScaleUpTimes}px`,"--enlarger-magnify-img-width":`${this.imgNaturalWidth}px`,"--enlarger-magnify-img-height":`${this.imgNaturalHeight}px`})}getImageNaturalSize(e,i){const s=new Image;s.src=e,s.onload=()=>{this.imgNaturalWidth=s.naturalWidth||s.width,this.imgNaturalHeight=s.naturalHeight||s.height,i&&i()}}getContainer(){if(this.containerEl)return this.containerEl;try{this.containerEl=typeof this.userOptions.container=="string"?document.querySelector(this.userOptions.container):this.userOptions.container}catch(e){throw Error(h.getContainerError)}return this.containerEl}getMaskEl(){const e=this.getContainer().querySelector(".enlarger-main__mask");if(!e)throw Error(h.getMaskElError);return e}getEnlargerMainEl(){const e=this.getContainer().querySelector(".enlarger-main");if(!e)throw Error(h.getEnlargerMainElError);return e}getMagnifyContainer(){const e=this.getContainer().querySelector(".enlarger-magnify");if(!e)throw Error(h.getMagnifyContainerError);return e}getMagnifyImgEl(){const e=this.getContainer().querySelector(".enlarger-magnify__img");if(!e)throw Error(h.getMagnifyImgElError);return e}maskVisibleListener(){this.maskVisible=!this.maskVisible,l.css(this.getMaskEl(),{display:this.maskVisible?"block":"none"}),l.css(this.getMagnifyContainer(),{display:this.maskVisible?"block":"none"})}magnifyListener(e){const i=this.getContainer(),s=this.getEnlargerMainEl(),n=this.getMaskEl(),g=this.getMagnifyImgEl(),y=e.pageX-i.offsetLeft,E=e.pageY-i.offsetTop,c=i.offsetWidth-n.offsetWidth,d=i.offsetHeight-n.offsetHeight;let a=y-n.offsetWidth/2,o=E-n.offsetHeight/2;a<=0&&(a=0),a>=c&&(a=c),o<0&&(o=0),o>=d&&(o=d),n.style.left=a+"px",n.style.top=o+"px",g.style.left=-a/s.offsetWidth*g.offsetWidth+"px",g.style.top=-o/s.offsetHeight*g.offsetHeight+"px"}registorListeners(){const e=this.getEnlargerMainEl();this.removeListeners(),e.addEventListener("mouseover",this.maskVisibleListener),e.addEventListener("mouseout",this.maskVisibleListener),e.addEventListener("mousemove",this.magnifyListener)}removeListeners(){const e=this.getEnlargerMainEl();e.removeEventListener("mouseover",this.maskVisibleListener),e.removeEventListener("mouseout",this.maskVisibleListener),e.removeEventListener("mousemove",this.magnifyListener)}render(){this.initOptions(),this.initCSSVars();const e=this.getContainer();l.addClass(e,"enlarger-container");const i=`
      <div class="enlarger-main">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-main__img" />
        <div class="enlarger-main__mask"></div>
      </div>
      <div class="enlarger-magnify">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-magnify__img" />
      </div>
    `;e.innerHTML=i,this.registorListeners()}destory(){var e;this.removeListeners(),(e=this.resizeObserver)==null||e.unobserve(this.getContainer())}}const C=t=>new u(t);exports.Enlarger=u;exports.createEnlarger=C;
