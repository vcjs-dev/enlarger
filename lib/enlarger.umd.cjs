(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("fourdom")):typeof define=="function"&&define.amd?define(["exports","fourdom"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.Enlarger={},t.fourdom))})(this,function(t,e){"use strict";var p=Object.defineProperty;var k=(t,e,n)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var g=(t,e,n)=>(k(t,typeof e!="symbol"?e+"":e,n),n);var n=(s=>(s.getContainerError="container element is missing.",s.getMaskElError="mask element is missing.",s.getEnlargerMainElError="enlarger main element is missing.",s.getMagnifyContainerError="magnify container element is missing.",s.getMagnifyImgElError="magnify img element is missing.",s))(n||{});class f{constructor(i){g(this,"options",{container:"",src:"",alt:"",width:0,height:0,maskColor:"rgba(255, 255, 0, 0.4)",maskWidth:0,maskHeight:0,magnifyImgScaleUpTimes:2});g(this,"maskVisible",!1);g(this,"imgNaturalWidth",0);g(this,"imgNaturalHeight",0);g(this,"magnifyImgWidthScaleUpTimes",1);g(this,"magnifyImgHeightScaleUpTimes",1);g(this,"containerEl",null);this.options=Object.assign(this.options,i),this.maskVisibleListener=this.maskVisibleListener.bind(this),this.magnifyListener=this.magnifyListener.bind(this),this.getImageNaturalSize(this.options.src,()=>{this.magnifyImgWidthScaleUpTimes=i!=null&&i.width?this.imgNaturalWidth/i.width:this.options.magnifyImgScaleUpTimes,this.options.width=(i==null?void 0:i.width)||this.imgNaturalWidth/this.magnifyImgWidthScaleUpTimes,this.magnifyImgHeightScaleUpTimes=i!=null&&i.height?this.imgNaturalHeight/i.height:this.magnifyImgWidthScaleUpTimes,this.options.height=(i==null?void 0:i.height)||this.imgNaturalHeight/this.magnifyImgHeightScaleUpTimes,this.options.maskWidth=this.options.maskWidth||this.options.width/2,this.options.maskHeight=this.options.maskHeight||this.options.width/2,this.render()})}initCSSVars(){const i=this.getContainer();e.css(i,{"--enlarger-width":`${this.options.width}px`,"--enlarger-height":`${this.options.height}px`,"--enlarger-mask-color":this.options.maskColor,"--enlarger-mask-width":`${this.options.maskWidth}px`,"--enlarger-mask-height":`${this.options.maskHeight}px`,"--enlarger-magnify-width":`${this.options.maskWidth*this.magnifyImgWidthScaleUpTimes}px`,"--enlarger-magnify-height":`${this.options.maskHeight*this.magnifyImgHeightScaleUpTimes}px`,"--enlarger-magnify-img-width":`${this.imgNaturalWidth}px`,"--enlarger-magnify-img-height":`${this.imgNaturalHeight}px`})}getImageNaturalSize(i,r){const a=new Image;a.src=i,this.imgNaturalWidth=a.naturalWidth||a.width,this.imgNaturalHeight=a.naturalHeight||a.height,a.onload=()=>{r&&r()}}getContainer(){if(this.containerEl)return this.containerEl;try{this.containerEl=typeof this.options.container=="string"?document.querySelector(this.options.container):this.options.container}catch(i){throw Error(n.getContainerError)}return this.containerEl}getMaskEl(){const i=this.getContainer().querySelector(".enlarger-main__mask");if(!i)throw Error(n.getMaskElError);return i}getEnlargerMainEl(){const i=this.getContainer().querySelector(".enlarger-main");if(!i)throw Error(n.getEnlargerMainElError);return i}getMagnifyContainer(){const i=this.getContainer().querySelector(".enlarger-magnify");if(!i)throw Error(n.getMagnifyContainerError);return i}getMagnifyImgEl(){const i=this.getContainer().querySelector(".enlarger-magnify__img");if(!i)throw Error(n.getMagnifyImgElError);return i}maskVisibleListener(){this.maskVisible=!this.maskVisible,e.css(this.getMaskEl(),{display:this.maskVisible?"block":"none"}),e.css(this.getMagnifyContainer(),{display:this.maskVisible?"block":"none"})}magnifyListener(i){const r=this.getContainer(),a=this.getEnlargerMainEl(),o=this.getMaskEl(),l=this.getMagnifyImgEl(),E=i.pageX-r.offsetLeft,u=i.pageY-r.offsetTop,c=r.offsetWidth-o.offsetWidth,d=r.offsetHeight-o.offsetHeight;let h=E-o.offsetWidth/2,m=u-o.offsetHeight/2;h<=0&&(h=0),h>=c&&(h=c),m<0&&(m=0),m>=d&&(m=d),o.style.left=h+"px",o.style.top=m+"px",l.style.left=-h/a.offsetWidth*l.offsetWidth+"px",l.style.top=-m/a.offsetHeight*l.offsetHeight+"px"}registorListeners(){const i=this.getEnlargerMainEl();i.addEventListener("mouseover",this.maskVisibleListener),i.addEventListener("mouseout",this.maskVisibleListener),i.addEventListener("mousemove",this.magnifyListener)}removeListeners(){const i=this.getEnlargerMainEl();i.removeEventListener("mouseover",this.maskVisibleListener),i.removeEventListener("mouseout",this.maskVisibleListener),i.removeEventListener("mousemove",this.magnifyListener)}render(){const i=this.getContainer(),r=`
      <div class="enlarger-main">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-main__img" />
        <div class="enlarger-main__mask"></div>
      </div>
      <div class="enlarger-magnify">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-magnify__img" />
      </div>
    `;e.addClass(i,"enlarger-container"),this.initCSSVars(),i.innerHTML=r,this.registorListeners()}destory(){this.removeListeners()}}const y=s=>new f(s),L="";t.Enlarger=f,t.createEnlarger=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
