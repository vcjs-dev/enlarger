(function(s,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("fourdom")):typeof define=="function"&&define.amd?define(["exports","fourdom"],i):(s=typeof globalThis!="undefined"?globalThis:s||self,i(s.Enlarger={},s.fourdom))})(this,function(s,i){"use strict";var v=Object.defineProperty;var u=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var c=(s,i,t)=>i in s?v(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t,y=(s,i)=>{for(var t in i||(i={}))C.call(i,t)&&c(s,t,i[t]);if(u)for(var t of u(i))L.call(i,t)&&c(s,t,i[t]);return s};var a=(s,i,t)=>(c(s,typeof i!="symbol"?i+"":i,t),t);var t=(o=>(o.getContainerError="container element is missing.",o.getMaskElError="mask element is missing.",o.getEnlargerMainElError="enlarger main element is missing.",o.getMagnifyContainerError="magnify container element is missing.",o.getMagnifyImgElError="magnify img element is missing.",o))(t||{});class f{constructor(e){a(this,"userOptions",{container:"",src:""});a(this,"options",{container:"",src:"",alt:"",width:0,height:0,resizeable:!1,magnifyImgScaleUpTimes:2,maskColor:"rgba(255, 255, 255, 0.2)",maskTimesSmallerThanImage:2,maskCursor:"crosshair",maskBorderColor:"#bbbbbb",maskBorderWidth:"1px",maskBorderStyle:"solid"});a(this,"maskWidth",0);a(this,"maskHeight",0);a(this,"maskVisible",!1);a(this,"imgNaturalWidth",0);a(this,"imgNaturalHeight",0);a(this,"magnifyImgWidthScaleUpTimes",1);a(this,"magnifyImgHeightScaleUpTimes",1);a(this,"containerEl",null);a(this,"resizeObserver",null);this.userOptions=y({},e),this.maskVisibleListener=this.maskVisibleListener.bind(this),this.magnifyListener=this.magnifyListener.bind(this),this.getImageNaturalSize(e.src,()=>{this.initResizeObserver(),this.render()})}setOptions(e){return this.userOptions=Object.assign(this.userOptions,e),this.render(),this}setWidth(e){return this.userOptions=Object.assign(this.userOptions,{width:e}),this.render(),this}setHeight(e){return this.userOptions=Object.assign(this.userOptions,{height:e}),this.render(),this}initResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{for(const r of e){const n=r.target;this.setWidth(n.offsetWidth)}}),this.resizeObserver.observe(this.getContainer())}initOptions(){const e=this.userOptions;this.options=Object.assign(this.options,e),this.magnifyImgWidthScaleUpTimes=e!=null&&e.width?this.imgNaturalWidth/e.width:this.options.magnifyImgScaleUpTimes,this.options.width=(e==null?void 0:e.width)||this.imgNaturalWidth/this.magnifyImgWidthScaleUpTimes,this.magnifyImgHeightScaleUpTimes=e!=null&&e.height?this.imgNaturalHeight/e.height:this.magnifyImgWidthScaleUpTimes,this.options.height=(e==null?void 0:e.height)||this.imgNaturalHeight/this.magnifyImgHeightScaleUpTimes,this.maskWidth=this.options.width/this.options.maskTimesSmallerThanImage,this.maskHeight=this.options.width/this.options.maskTimesSmallerThanImage}initCSSVars(){const e=this.getContainer(),r=this.options.resizeable?"auto":`${this.options.width}px`,n=this.options.resizeable?"auto":`${this.options.height}px`;i.css(e,{"--enlarger-width":r,"--enlarger-height":n,"--enlarger-mask-color":this.options.maskColor,"--enlarger-mask-width":`${this.maskWidth}px`,"--enlarger-mask-height":`${this.maskHeight}px`,"--enlarger-mask-border-width":this.options.maskBorderWidth,"--enlarger-mask-border-color":this.options.maskBorderColor,"--enlarger-mask-border-style":this.options.maskBorderStyle,"--enlarger-mask-cursor":this.options.maskCursor,"--enlarger-magnify-position-left":`${this.options.width+10}px`,"--enlarger-magnify-width":`${this.maskWidth*this.magnifyImgWidthScaleUpTimes}px`,"--enlarger-magnify-height":`${this.maskHeight*this.magnifyImgHeightScaleUpTimes}px`,"--enlarger-magnify-img-width":`${this.imgNaturalWidth}px`,"--enlarger-magnify-img-height":`${this.imgNaturalHeight}px`})}getImageNaturalSize(e,r){const n=new Image;n.src=e,n.onload=()=>{this.imgNaturalWidth=n.naturalWidth||n.width,this.imgNaturalHeight=n.naturalHeight||n.height,r&&r()}}getContainer(){if(this.containerEl)return this.containerEl;try{this.containerEl=typeof this.userOptions.container=="string"?document.querySelector(this.userOptions.container):this.userOptions.container}catch(e){throw Error(t.getContainerError)}return this.containerEl}getMaskEl(){const e=this.getContainer().querySelector(".enlarger-main__mask");if(!e)throw Error(t.getMaskElError);return e}getEnlargerMainEl(){const e=this.getContainer().querySelector(".enlarger-main");if(!e)throw Error(t.getEnlargerMainElError);return e}getMagnifyContainer(){const e=this.getContainer().querySelector(".enlarger-magnify");if(!e)throw Error(t.getMagnifyContainerError);return e}getMagnifyImgEl(){const e=this.getContainer().querySelector(".enlarger-magnify__img");if(!e)throw Error(t.getMagnifyImgElError);return e}maskVisibleListener(){this.maskVisible=!this.maskVisible,i.css(this.getMaskEl(),{display:this.maskVisible?"block":"none"}),i.css(this.getMagnifyContainer(),{display:this.maskVisible?"block":"none"})}magnifyListener(e){const r=this.getContainer(),n=this.getEnlargerMainEl(),h=this.getMaskEl(),m=this.getMagnifyImgEl(),k=e.pageX-r.offsetLeft,b=e.pageY-r.offsetTop,d=r.offsetWidth-h.offsetWidth,p=r.offsetHeight-h.offsetHeight;let g=k-h.offsetWidth/2,l=b-h.offsetHeight/2;g<=0&&(g=0),g>=d&&(g=d),l<0&&(l=0),l>=p&&(l=p),h.style.left=g+"px",h.style.top=l+"px",m.style.left=-g/n.offsetWidth*m.offsetWidth+"px",m.style.top=-l/n.offsetHeight*m.offsetHeight+"px"}registorListeners(){const e=this.getEnlargerMainEl();this.removeListeners(),e.addEventListener("mouseover",this.maskVisibleListener),e.addEventListener("mouseout",this.maskVisibleListener),e.addEventListener("mousemove",this.magnifyListener)}removeListeners(){const e=this.getEnlargerMainEl();e.removeEventListener("mouseover",this.maskVisibleListener),e.removeEventListener("mouseout",this.maskVisibleListener),e.removeEventListener("mousemove",this.magnifyListener)}render(){this.initOptions(),this.initCSSVars();const e=this.getContainer();i.addClass(e,"enlarger-container");const r=`
      <div class="enlarger-main">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-main__img" />
        <div class="enlarger-main__mask"></div>
      </div>
      <div class="enlarger-magnify">
        <img src="${this.options.src}" alt="${this.options.alt}" class="enlarger-magnify__img" />
      </div>
    `;e.innerHTML=r,this.registorListeners()}destory(){var e;this.removeListeners(),(e=this.resizeObserver)==null||e.unobserve(this.getContainer())}}const E=o=>new f(o),S="";s.Enlarger=f,s.createEnlarger=E,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
